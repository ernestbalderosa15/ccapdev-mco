{{> header_nav}}

<div class="container" id="feed-main">
  <div class="row justify-content-between">
    <!-- Left column -->
    {{> sidenav}}
    <!-- Create post -->
    <div class="col-8">


      <!-- Post -->
          <div class="container-box-feed"  data-post-id="1">
            
            <div class="content-feed">
                                <!-- Back Button -->
                                <a href="/" class="form-back-button">
                                    <i class="bi bi-arrow-left"></i> Back
                                </a>
            
              <!-- Profile, Username, Time -->
                <div class="post-feed">
                <div class="user-avatar">
                  <img
                    src="https://i.pravatar.cc/150?img=54"
                    alt="avatar"
                    class="user-avatar"
                    />
                </div>
                <div class="post-content">
                  <p class="username">@RobertKilla</p>
                  <p class="time">Just now</p>
                </div>
              </div>

              <span class="post-dropdown">
                    <div class="dropdown">
                        <button class="post-dropdown-toggle float-end" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            &#8942;
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><button class="dropdown-item post-edit-btn" type="button">Edit</button></li>
                            <li><button class="dropdown-item post-delete-btn" type="button">Delete</button></li>
                        </ul>
                    </div>
                </span>

              
              
              <!-- Post Title -->
              <h1>Help! Need Tips for Starting a Balcony Garden</h1>

              <div class="post-body">
                Hi everyone,
                <br><br>
                I'm a complete beginner when it comes to gardening, but I'm excited to try growing some herbs and vegetables on my apartment balcony!  I know there's limited space, but I'm hoping to create a little urban oasis.
                <br><br>
                Does anyone have any tips for someone just starting out with a balcony garden?
                <br><br>
                What are some easy-to-grow vegetables and herbs for beginners?
                Any recommendations for good quality pots and soil for container gardening?
                How much sunlight do most vegetables and herbs need each day?
                <br><br>
                Any advice would be greatly appreciated!  Thanks in advance!
              </body>
              </div>
              <!-- Post Image -->

              <img
              src="https://www.thespruce.com/thmb/gF9yLFJBtskM1A1elZ20ZI8U-bU=/4285x0/filters:no_upscale():max_bytes(150000):strip_icc()/tips-for-starting-a-balcony-garden-847801-hero-f51f8bf03e1949ea95d429c842b6837c.jpg"
              alt="Post Image"
                class="post-image"
              />

              <!-- Post Buttons -->
              <div class="post-actions">
                <div class="button-container">
                  <div class="button hollow-button">
                    <i class="bi bi-arrow-up"></i>
                    <span class="upvotes">7</span>
                  </div>
                </div>
                <div class="button-container">
                  <div class="button hollow-button">
                    <i class="bi bi-arrow-down"></i>
                  </div>
                </div>
                <div class="button-container">
                  <div class="button">
                    <i class="bi bi-chat-dots"></i>
                    <span class="comments">3</span>
                  </div>
                </div>
                <div class="button-container">
                  <div class="button">
                    <i class="bi bi-bookmark"></i>
                  </div>
                </div>
                <div class="button-container">
                  <div class="button">
                    <i class="bi bi-share"></i>
                  </div>
                </div>
              </div>
              <br><br>
              <!-- comment form -->
              <form id="comment-form" class="d-flex input-group w-auto my-auto mb-3 mb-md-0">
                <input 
                  id="comment-input"
                  autocomplete="off"
                  type="Comment"
                  class="form-control rounded"
                  placeholder="Comment"
                />
                <span class="input-group-text border-0 d-none d-lg-flex">
                  <button type="submit" >
                    <i class="bi bi-plus-circle"></i>
                  </button>
                </span>
              </form>

              <!-- Comments Section -->
              <div id = "comsec" class="comments-section mt-3">

              </div>
              <br>

              
            </div>
          </div>

    </div>
      {{> sidebar1}}
  </div>

  
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>


<script>
  //upvote
  $(document).on("click", ".upvote-btn", function () {
    const postId = $(this).data("post-id");
    $.post("/upvote", { postId: postId }, function (data) {
      if (data.success) {
        $.get(`/post/${postId}`, function (postData) {
          if (postData.success) {
            const post = postData.post;
            $(`.upvote-btn[data-post-id='${postId}'] .upvotes`).text(post.postUp);
            $(`.downvote-btn[data-post-id='${postId}'] .downvotes`).text(post.postDown);
            
          } else {
            console.error("Failed to load post data:", postData.message);
          }
        }).fail(function () {
          console.error("Error occurred while fetching the post data");
        });
      } else {
        console.error("Failed to upvote post:", data.message);
      }
    }).fail(function () {
      console.error("Error occurred while making the upvote request");
    });
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editBtn = document.querySelector('.post-edit-btn');
    const deleteBtn = document.querySelector('.post-delete-btn');
    
    if (editBtn) {
        editBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to edit this post?')) {
                alert('The Edit feature is still to be implemented.');
            }
        });
    }

    if (deleteBtn) {
        deleteBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to delete this post?')) {
                alert('The Delete feature is still to be implemented.');
            }
        });
    }
});
</script>


<script>
  //add listeners for comment actions
document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('comment-form');
    const commentInput = document.getElementById('comment-input');
    const commentsSection = document.getElementById('comsec');

    //comment box
    commentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        addComment(commentInput.value);
        commentInput.value = '';
    });

    //comment dropdown
    commentsSection.addEventListener('click', function(e) {
        if (e.target.classList.contains('reply-btn')) {
            replyToComment(e.target.closest('.comment'));
        } else if (e.target.classList.contains('edit-btn')) {
            editComment(e.target.closest('.comment'));
        } else if (e.target.classList.contains('delete-btn')) {
            deleteComment(e.target.closest('.comment'));
        }
    });

    function addComment(text, parentComment = null) {
    //craete comment div 
    const newComment = document.createElement('div');
    newComment.className = 'comment';
    newComment.innerHTML = `
        <div class="comment-avatar">
            <img src="https://i.pravatar.cc/150?img=2">
        </div>
        <div class="comment-body">
            <div class="comment-username">
                @DesignEye <span class="comment-time"> | Just now</span>
                <span class="comment-dropdown">
                    <div class="dropdown">
                        <button class="comment-dropdown-toggle float:right" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            &#8942;
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li class="dropdown-item reply-btn" >Reply</a></li>
                            <li class="dropdown-item edit-btn" >Edit</a></li>
                            <li class="dropdown-item delete-btn" >Delete</a></li>
                            <li><a class="dropdown-item" href="#">Save</a></li>
                            <li><a class="dropdown-item" href="#">Share</a></li>
                        </ul>
                    </div>
                </span>
            </div>
            <div class="comment-text">${text}</div>
            <div class="child-comments"></div>
        </div>
    `;
    //append comment
    if (parentComment) {
        const childCommentsContainer = parentComment.querySelector('.child-comments');
        childCommentsContainer.appendChild(newComment);
    } else {
        commentsSection.appendChild(newComment);
    }
}
    //show reply form
    function replyToComment(comment) {
        const replyForm = document.createElement('form');
        replyForm.innerHTML = `
            <br><br>
            <input type="text" class="form-control rounded" placeholder="Reply">
            <button type="submit" class="btn btn-primary">Submit</button>
        `;
        replyForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const replyText = this.querySelector('input').value;
            addComment(replyText, comment);
            this.remove();//remove form when comment is submitted
        });
        comment.appendChild(replyForm);
    }
    //replace comment text
    function editComment(comment) {
        const commentText = comment.querySelector('.comment-text');
        const originalText = commentText.textContent;
        const editInput = document.createElement('input');
        
        editInput.type = 'text';
        editInput.className = 'form-control rounded';
        editInput.value = originalText;
        commentText.replaceWith(editInput);

        editInput.focus();
        editInput.addEventListener('blur', function() {
            const newText = this.value;
            const newCommentText = document.createElement('div');
            newCommentText.className = 'comment-text';
            newCommentText.textContent = newText;
            this.replaceWith(newCommentText);
        });
    }
    //remove comment div
    function deleteComment(comment) {
        if (confirm('Are you sure you want to delete this comment?')) {
            comment.remove();
        }
    }


});
</script>

