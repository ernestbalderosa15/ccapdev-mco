{{>header_nav}}

<div class="container" id="feed-main">
    <div class="row justify-content-between">
        <!-- Left column -->
        {{>sidenav}}
        <div class="col-8">
            <div class="form-container-box-feed mb-3">
                <div class="form-content-feed">
                    <!-- Back Button -->
                    <a href="./" class="form-back-button">
                        <i class="bi bi-arrow-left"></i> Back
                    </a>

                    <!-- Create Post Form -->
                    <h1>Create a Post</h1>
                    <form id="post-form" class="form-post-form" method="post">
                        <!-- Title -->
                        <label for="post-title">Title:</label>
                        <input type="text" id="post-title" name="title" required />

                        <!-- Body -->
                        <label for="editor">Body:</label>
                        <!-- Rich text editor-->
                        <div id="editor"></div>
                    </form>
                    <div class="wrapper">
                        <i class="bi bi-tags-fill px-2"></i>Tags
                        <div class="tags">
                            <p>Press enter or add a comma after each tag</p>
                            <ul>
                                <input type="text" spellcheck="false" />
                            </ul>
                        </div>
                        <div class="details">
                            <p><span>10</span> tags are remaining</p>
                            <button>Remove All</button>
                        </div>
                    </div>
                    <button type="button" class="form-post-form-button" id="submit-post">
                        Submit Post
                    </button>
                </div>
            </div>
        </div>

        <div class="col-2"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize CKEditor
    ClassicEditor.create(document.querySelector("#editor"))
        .then(editor => {
            console.log(editor);
        })
        .catch(error => {
            console.error(error);
        });

    // Tags functionality
    const ul = document.querySelector(".tags ul");
    const input = document.querySelector(".tags input");
    const tagNumb = document.querySelector(".details span");
    const removeBtn = document.querySelector(".details button");

    let maxTags = 10,
    tags = [];

    function countTags() {
        input.focus();
        tagNumb.innerText = maxTags - tags.length;
    }

    function createTag() {
        ul.querySelectorAll("li").forEach(li => li.remove());
        tags.slice().reverse().forEach(tag => {
            let liTag = `<li>${tag} <i class="bi bi-x" onclick="remove(this, '${tag}')"></i></li>`;
            ul.insertAdjacentHTML("afterbegin", liTag);
        });
        countTags();
    }

    function remove(element, tag) {
        let index = tags.indexOf(tag);
        tags = [...tags.slice(0, index), ...tags.slice(index + 1)];
        element.parentElement.remove();
        countTags();
    }

    function addTag(e) {
        if (e.key === "Enter") {
            let tag = e.target.value.replace(/\s+/g, ' ');
            if (tag.length > 1 && !tags.includes(tag)) {
                if (tags.length < 10) {
                    tag.split(',').forEach(tag => {
                        tags.push(tag);
                        createTag();
                    });
                }
            }
            e.target.value = "";
        }
    }

    input.addEventListener("keyup", addTag);

    removeBtn.addEventListener("click", () => {
        tags.length = 0;
        ul.querySelectorAll("li").forEach(li => li.remove());
        countTags();
    });

    // Handle form submission
    document.getElementById('submit-post').addEventListener('click', function() {
        // Here you would typically send the data to your server
        // For now, we'll just redirect to the home page
        window.location.href = '/';
    });

    countTags();
});
</script>